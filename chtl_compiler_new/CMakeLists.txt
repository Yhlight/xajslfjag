cmake_minimum_required(VERSION 3.16)
project(CHTL_Compiler VERSION 1.0.0 LANGUAGES CXX)

# è®¾ç½®C++æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ç¼–è¯‘é€‰é¡¹
set(CMAKE_CXX_FLAGS_DEBUG "-g -O0 -Wall -Wextra")
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -DNDEBUG")

# è®¾ç½®è¾“å‡ºç›®å½•
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)

# åŒ…å«ç›®å½•
include_directories(src)

# æ”¶é›†æºæ–‡ä»¶
file(GLOB_RECURSE CORE_SOURCES "src/Core/*.cpp")
file(GLOB_RECURSE CHTL_SOURCES "src/CHTL/*.cpp")
file(GLOB_RECURSE SCANNER_SOURCES "src/Scanner/*.cpp")
file(GLOB_RECURSE UTIL_SOURCES "src/Util/*.cpp")

# åˆ›å»ºCHTLç¼–è¯‘å™¨åº“
add_library(chtl_compiler_lib STATIC
    ${CORE_SOURCES}
    ${CHTL_SOURCES}
    ${SCANNER_SOURCES}
    ${UTIL_SOURCES}
)

# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ (æš‚æ—¶åªæ˜¯åŸºç¡€æµ‹è¯•)
add_executable(chtl_compiler
    tests/basic_test.cpp
)

# é“¾æ¥åº“
target_link_libraries(chtl_compiler chtl_compiler_lib)

# è®¾ç½®ç¼–è¯‘å™¨ç‰¹æ€§
target_compile_features(chtl_compiler_lib PUBLIC cxx_std_17)
target_compile_features(chtl_compiler PUBLIC cxx_std_17)

# å®‰è£…ç›®æ ‡
install(TARGETS chtl_compiler RUNTIME DESTINATION bin)
install(TARGETS chtl_compiler_lib ARCHIVE DESTINATION lib)

# åˆ›å»ºç‰ˆæœ¬å¤´æ–‡ä»¶
configure_file(
    "${CMAKE_SOURCE_DIR}/version.h.in"
    "${CMAKE_BINARY_DIR}/version.h"
)

# è¾“å‡ºé…ç½®ä¿¡æ¯
message(STATUS "CHTL Compiler Configuration:")
message(STATUS "  C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "  Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "  Source Directory: ${CMAKE_SOURCE_DIR}")
message(STATUS "  Binary Directory: ${CMAKE_BINARY_DIR}")
message(STATUS "ğŸ¯ ä¸¥æ ¼æŒ‰ç…§CHTLè¯­æ³•æ–‡æ¡£å®ç°ï¼Œè¿½æ±‚å®Œæ•´ä¸ç»å¯¹å‡†ç¡®ï¼")
message(STATUS "ğŸ—ï¸ å…¨æ–°æ¶æ„ï¼Œä»å¤´æ„å»ºï¼Œé¿å…å†å²é—ç•™é—®é¢˜")
message(STATUS "âš¡ æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰å®Œæ•´å®ç°")